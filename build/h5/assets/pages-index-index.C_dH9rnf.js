<<<<<<<< HEAD:build/h5/assets/pages-index-index.Bn93pLLy.js
import{g as t,v as i,o as e,c as s,w as o,a,n as l,b as r,d as n,t as h,e as c,F as g,r as d,i as u,f as m,h as p,S as f,j as w}from"./index-DrnTByWt.js";var S={},H={},v=!1,T=!1;function D(t){void 0===S[t]&&(S[t]=0)}var _=null,x=null,L=null,y=0,M=!1;function C(t,i){R.longTouch&&(v=!0,O(i,0))}var k="";function O(t,i){var e=t.getState();_.removeClass("hide"),_.hasClass("show")||_.addClass("show"),x.setStyle({transform:"translate3d(0,"+i+"px,10px)","-webkit-transform":"translate3d(0,"+i+"px,10px)"}),L.hasClass("hide")||L.addClass("hide"),L.removeClass("ani");var s=e.shadowRowTop+i+R.rowHeight/2,o=S[R.guid],a={guid:R.guid,command:s<.2*R.ListHeight?"up":s>R.ListHeight-.2*R.ListHeight?"down":"stop",scrollTop:o};k!=a.command&&(k=a.command,R.autoScroll&&t.callMethod("pageScroll",a));var l=i+S[R.guid]-e.initscrollTop,r=function(t,i){var e=t+parseInt(i/R.rowHeight),s=i%R.rowHeight;s>0?(e+=s/R.rowHeight>=.6?1:0)<b&&(e=s/R.rowHeight<=.4?e:b):(e+=s/R.rowHeight<=-.6?-1:0)>b&&(e=s/R.rowHeight>=-.4?e:b);return e}(y,l);if((r<=2||r>=R.listLength-2)&&(a.command="stop"),(!R.autoScroll||R.isAppH5||"stop"==a.command)&&(b=null==b?y:b,!(r<0||r>=R.listLength)&&r!=b)){b=r,e.offset=r,t.callMethod("change",{index:y,moveTo:e.offset});for(var n=0;n<H[R.guid].length;n++){var h=H[R.guid][n].lastSort,c=H[R.guid][n].newSort;if(c=h>=r&&h<=y||h<=r&&h>=y?h==y?r:h<y?h+1:h-1:h,H[R.guid][n].newSort!=c){H[R.guid][n].newSort=c;var g=100*(H[R.guid][n].newSort-H[R.guid][n].sort);H[R.guid][n].rowView.hasClass("ani")||H[R.guid][n].rowView.addClass("ani"),H[R.guid][n].rowView.setStyle({transform:"translate3d(0,"+g+"%,0)","-webkit-transform":"translate3d(0,"+g+"%,0)"})}}I(t)}}var b=null;var N,V,A="undefined"!=typeof plus&&"iOS"==plus.os.name;function I(t){R.feedbackGenerator&&(A?setTimeout((function(){V.selectionChanged()}),0):"undefined"!=typeof plus?plus.device.vibrate(12):t.callMethod("vibrate"))}A&&(N=plus.ios.importClass("UISelectionFeedbackGenerator"),(V=new N).init());var J={},R={};const j={receiveData:function(t,i,e){for(var s=JSON.parse(t),o={},a=!1,l=[],r=0;r<s.length;r++){var n=s[r];if("sortArray"===n[0])l=n[1];else"guid"==n[0]&&(a=!0),o[n[0]]=n[1]}if(a){var h=!1;void 0!==J[o.guid]&&void 0!==J[o.guid].lastInitTime&&J[o.guid].lastInitTime==o.lastInitTime||(h=!0),J[o.guid]=o,h&&function(t,i,e){H[t]=[];for(var s=i.selectAllComponents(".hm-row"),o=0;o<s.length;o++){var a={id:s[o].getDataset().id,sort:o,lastSort:parseInt(s[o].getDataset().sort),newSort:o,rowView:s[o]};e.length>0&&(a.lastSort=e[o],a.newSort=a.lastSort),H[t].push(a);var l=100*(a.lastSort-a.sort);a.rowView.setStyle({transform:"translate3d(0,"+l+"%,0)","-webkit-transform":"translate3d(0,"+l+"%,0)"})}}(o.guid,e,l)}},scroll:function(t,i){var e=i.selectComponent("#dataView").getDataset();D(e.guid),S[e.guid]=t.detail.scrollTop},longpress:C,touchstart:function(t,i){if(!M){M=!0,"undefined"==typeof setTimeout&&void 0!==i.setTimeout&&(setTimeout=i.setTimeout,clearTimeout=i.clearTimeout),v=!1;var e=t.instance.getDataset(),s=i.getState();1==t.touches.length&&(s.point=t.touches[0],s.islongTap=!0,s.rowData=e,function(t,i){var e=i.selectComponent("#dataView").getDataset();D((R=J[e.guid]).guid),t.initscrollTop=S[R.guid]}(s,i));var o=t.instance.getComputedStyle(["height"]);R.rowHeight=parseFloat(o.height);var a=(y=function(t,i){for(var e=0;e<H[R.guid].length;e++)if(H[R.guid][e].id==t)return L=H[R.guid][e].rowView,H[R.guid][e].lastSort}(e.id))*R.rowHeight;a-=S[R.guid],i.callMethod("loadShadowRow",{rowSort:y}),s.shadowRowTop=a,(_=i.selectComponent("#shadowRowBox")).setStyle({top:a+"px"}),x=i.selectComponent("#shadowRow"),R.longTouch&&(T&&clearTimeout(T),T=setTimeout((function(){C(t,i)}),R.longTouchTime))}},touchmove:function(t,i){var e=i.getState();t.instance.getDataset();var s=t.touches[0],o=e.point,a=s.pageY-o.pageY;if(!R.longTouch||(Math.abs(a)>10&&clearTimeout(T),v))return O(i,a),t.preventDefault&&t.preventDefault(),!1},touchend:function(t,i){if(R.longTouch&&(clearTimeout(T),!v))return b=null,void(M=!1);"stop"!=k&&(k="stop",R.autoScroll&&i.callMethod("pageScroll",{guid:R.guid,command:"stop"}));var e=i.getState();if(e.rowData.id,L.removeClass("hide"),e.offset,_.removeClass("show"),_.addClass("hide"),_.setStyle({}),void 0===e.offset||y==e.offset||null==e.offset)return M=!1,I(i),!1;for(var s=[],o=0;o<H[R.guid].length;o++)H[R.guid][o].lastSort=H[R.guid][o].newSort,s.push(H[R.guid][o].newSort),H[R.guid][o].rowView.removeClass("ani");return i.callMethod("sort",{index:y,offset:e.offset,sortArray:s}),e.offset=null,b=null,M=!1,I(i),!1}},F=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("drag"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.drag=j}})},$={data:()=>({e:null,ScrollView:null}),methods:{runCommand(t){null!=t&&(this.e=t,this.getScrollView(document.getElementById("scrollView_"+this.e.guid)),window.cancelAnimationFrame(this.AnimationFrameID),this.AnimationFrameID=window.requestAnimationFrame(this.Animation),"stop"!=t.command||window.cancelAnimationFrame(this.AnimationFrameID))},Animation(){if("stop"==this.e.command)return void window.cancelAnimationFrame(this.AnimationFrameID);let t=this.e.rowLength*this.e.rowHeight-this.e.ListHeight;"up"==this.e.command?this.ScrollView.scrollTop-=3:"down"==this.e.command&&(this.ScrollView.scrollTop+=3),this.ScrollView.scrollTop<0&&(this.ScrollView.scrollTop=0,window.cancelAnimationFrame(this.AnimationFrameID)),this.ScrollView.scrollTop>t&&(this.ScrollView.scrollTop=t,window.cancelAnimationFrame(this.AnimationFrameID)),this.AnimationFrameID=window.requestAnimationFrame(this.Animation)},getScrollView(t){if(null!=this.ScrollView)return this.ScrollView;let i=t.getAttribute("style");if("uni-scroll-view"==t.className&&null!=i&&i.indexOf("overflow")>-1&&i.indexOf("auto")>-1)return this.ScrollView=t,t;this.getScrollView(t.firstChild)}}},G=t=>{t.$renderjs||(t.$renderjs=[]),t.$renderjs.push("renderjs"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.renderjs=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),t.mixins.push($)},W=(t,i)=>{const e=t.__vccOpts||t;for(const[s,o]of i)e[s]=o;return e},B={name:"HM-dragSort",data(){return{guid:"",isAppH5:!0,shadowRow:{},dragList:[],ListHeight:this.listHeight,scrollViewTop:0,scrollCommand:null,isHoldTouch:!1,isScrolling:!1,scrollAnimation:!1,scrollTimer:null,wxsDataObj:[],wxsDataStr:"[]"}},emits:["change","confirm"],props:{feedbackGenerator:{value:Boolean,default:!0},longTouch:{value:Boolean,default:!1},autoScroll:{value:Boolean,default:!0},longTouchTime:{value:Number,default:300},list:{value:Array,default:[]},rowHeight:{value:Number,default:44},listHeight:{value:Number,default:0},listBackgroundColor:{value:String,default:"#fff"}},watch:{longTouch(t){t||console.error("vue3目前仅支持长按拖拽!"),this.pushWxsData("longTouch",t)},longTouchTime(t){this.pushWxsData("longTouchTime",t)},feedbackGenerator(t){this.pushWxsData("feedbackGenerator",t)},autoScroll(t){this.pushWxsData("autoScroll",t)},list:{handler(t){this.initList(t)},immediate:!0,deep:!0},listHeight:{handler(t){this.ListHeight=t,this.pushWxsData("ListHeight",this.ListHeight)},immediate:!0}},mounted(){this.guid=this.getGuid();const i=t();0==this.listHeight&&(this.ListHeight=i.windowHeight,i.windowHeight==i.screenHeight&&(this.ListHeight=i.windowHeight-45-i.statusBarHeight)),this.pushWxsData("isAppH5",this.isAppH5),this.pushWxsData("ListHeight",this.ListHeight),this.pushWxsData("longTouch",this.longTouch)},methods:{getGuid(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"_"+t()+"_"+t()+"_"+t()+"_"+t()+t()+t()},initList(){let t=JSON.parse(JSON.stringify(this.list));for(let i=0,e=t.length;i<e;i++)t[i].hasOwnProperty("HMDrag_id")||(t[i].HMDrag_id="HMDragId_"+this.getGuid()),t[i].HMDrag_sort=i;this.dragList.length>0?setTimeout((()=>{this.dragList.splice(0,this.dragList.length,...t)}),50):this.dragList=JSON.parse(JSON.stringify(t)),this.pushWxsData("lastInitTime",(new Date).valueOf())},loadShadowRow(t){this.shadowRow=this.getMoveRow(t.rowSort)},vibrate(){i()},pageScroll(t){if("up"==t.command||"down"==t.command){if(this.isHoldTouch||(this.isHoldTouch=!0,this.scrollViewTop=t.scrollTop),this.isScrolling)return;if(this.isScrolling=!0,this.isAppH5)return t.ListHeight=this.ListHeight,t.rowHeight=this.rowHeight,t.rowLength=this.dragList.length,void(this.scrollCommand=t);null!=this.scrollTimer&&clearInterval(this.scrollTimer);let i=this.rowHeight*this.dragList.length+1-this.ListHeight,e=!0;this.scrollTimer=setInterval((()=>{e&&(this.runScroll(t.command,i),e=!1,this.$nextTick((function(){e=!0})))}),16.6)}"stop"==t.command&&(this.scrollCommand=t,this.isScrolling&&this.stopScroll())},runScroll(t,i){"up"==t&&(this.scrollViewTop-=5),"down"==t&&(this.scrollViewTop+=5),this.scrollViewTop<0&&(this.scrollViewTop=0,clearInterval(this.scrollTimer)),this.scrollViewTop>i&&(this.scrollViewTop=i,clearInterval(this.scrollTimer))},stopScroll(){null!=this.scrollTimer&&clearInterval(this.scrollTimer),this.isScrolling=!1,this.scrollingtop=0},getMoveRow(t){for(let i=0,e=this.dragList.length;i<e;i++)if(this.dragList[i].HMDrag_sort==t)return JSON.parse(JSON.stringify(this.dragList[i]))},triggerClick(t,i){let e=JSON.parse(JSON.stringify(i));delete e.HMDrag_id,delete e.HMDrag_sort,this.$emit("onclick",{index:t,row:JSON.parse(JSON.stringify(e))})},change(t){t.moveRow=this.getMoveRow(t.index),delete t.moveRow.HMDrag_id,delete t.moveRow.HMDrag_sort,this.$emit("change",t)},sort(t){this.stopScroll(),this.isHoldTouch=!1;let i=this.getMoveRow(t.index);delete i.HMDrag_id,delete i.HMDrag_sort;let e=JSON.parse(JSON.stringify(this.dragList)),s=[];for(let o=0,a=e.length;o<a;o++){delete e[o].HMDrag_id,delete e[o].HMDrag_sort;let i=t.sortArray[o];this.dragList[o].HMDrag_sort=i,s[i]=e[o]}this.$emit("confirm",{list:s,index:t.index,moveTo:t.offset,moveRow:i})},getNowList(){let t=JSON.parse(JSON.stringify(this.dragList)),i=[];for(let e=0,s=t.length;e<s;e++){let s=t[e].HMDrag_sort;i[s]=t[e],delete i[s].HMDrag_id,delete i[s].HMDrag_sort}return i},splice(){let t=arguments[0],i=arguments[1],e=arguments.length,s=[];for(let r=2;r<e;r++){let i=arguments[r];i.HMDrag_id="HMDragId_"+this.getGuid(),i.HMDrag_sort=t+r-2,s.push(i)}let o=t,a=i>0?t+i-1:t,l=s.length-i;for(let r=this.dragList.length-1;r>=0;r--){let t=this.dragList[r].HMDrag_sort;if(!(t<o))if(i>0&&t>=o&&t<=a)this.dragList.splice(r,1);else if(0!=l&&t>=a){let i=t+l;this.dragList[r].HMDrag_sort=i}}return this.dragList.push(...s),this.pushNewSort(),JSON.parse(JSON.stringify(this.dragList)),this.getNowList()},push(){let t=arguments.length,i=[],e=this.dragList.length;for(let s=0;s<t;s++){let t=arguments[s];t.HMDrag_id="HMDragId_"+this.getGuid(),t.HMDrag_sort=e+s,i.push(t)}return this.dragList.push(...i),this.pushNewSort(),this.getNowList()},unshift(){let t=arguments.length,i=[];for(let e=0;e<t;e++){let t=arguments[e];t.HMDrag_id="HMDragId_"+this.getGuid(),t.HMDrag_sort=e,i.push(t)}for(let e=this.dragList.length-1;e>=0;e--){let i=this.dragList[e].HMDrag_sort+t;this.dragList[e].HMDrag_sort=i}return this.dragList.push(...i),this.pushNewSort(),this.getNowList()},pushNewSort(){let t=[];for(let i=0,e=this.dragList.length;i<e;i++)t.push(this.dragList[i].HMDrag_sort);this.pushWxsData("sortArray",t),this.pushWxsData("lastInitTime",(new Date).valueOf())},pushWxsData(t=null,i=null){this.wxsDataObj.splice(0,8,["guid",this.guid],["listLength",this.dragList.length],["ListHeight",this.ListHeight],["isAppH5",this.isAppH5],["longTouch",this.longTouch],["longTouchTime",this.longTouchTime],["feedbackGenerator",this.feedbackGenerator],["autoScroll",this.autoScroll]);let e=-1;for(let s=0;s<this.wxsDataObj.length;s++)if(this.wxsDataObj[s][0]==t){e=s;break}e>-1?this.wxsDataObj[e][1]=i:(this.wxsDataObj.push([t,i]),"sortArray"==t&&this.wxsDataObj.length),""!=this.guid&&(this.wxsDataStr=JSON.stringify(this.wxsDataObj))},compareVersion(t,i){t=t.split("."),i=i.split(".");const e=Math.max(t.length,i.length);for(;t.length<e;)t.push("0");for(;i.length<e;)i.push("0");for(let s=0;s<e;s++){const e=parseInt(t[s]),o=parseInt(i[s]);if(e>o)return 1;if(e<o)return-1}return 0}}};F(B),G(B);const q=W(B,[["render",function(t,i,w,S,H,v){const T=u,D=m,_=p,x=f;return e(),s(_,{class:"HM-drag-sort",style:l({height:H.ListHeight+"px","background-color":w.listBackgroundColor})},{default:o((()=>[a(_,{class:"rowBox-shadow",id:"shadowRowBox"},{default:o((()=>[a(_,{class:"hm-row-shadow move",id:"shadowRow"},{default:o((()=>[a(_,{class:"modules"},{default:o((()=>[a(_,{class:"row-content"},{default:o((()=>[a(_,{class:"row",style:l({height:w.rowHeight+"px"})},{default:o((()=>[H.shadowRow.icon?(e(),s(T,{key:0,class:"icon",src:H.shadowRow.icon},null,8,["src"])):r("",!0),a(D,{class:"text"},{default:o((()=>[n(h(H.shadowRow.name),1)])),_:1})])),_:1},8,["style"])])),_:1}),a(_,{class:"drag-content"},{default:o((()=>[a(_,{class:"drag-icon",style:l({height:w.rowHeight+"px"})},{default:o((()=>[a(D,{class:"iconfont icon-drag"})])),_:1},8,["style"])])),_:1})])),_:1})])),_:1})])),_:1}),a(x,{class:"color scroll-view",id:"scrollView_"+H.guid,"scroll-y":!0,style:l({height:H.ListHeight+"px"}),"scroll-top":H.scrollViewTop,onScroll:t.drag.scroll,"scroll-with-animation":H.scrollAnimation},{default:o((()=>[a(_,{class:"list"},{default:o((()=>[(e(!0),c(g,null,d(H.dragList,((i,c)=>(e(),s(_,{key:i.HMDrag_id,class:"rowBox ani"},{default:o((()=>[a(_,{class:"hm-row",style:l({transform:"translate3d(0,"+100*(i.HMDrag_sort-c)+"%,-1px)"}),"data-sort":i.HMDrag_sort,"data-id":i.HMDrag_id,id:i.HMDrag_id},{default:o((()=>[a(_,{class:"modules"},{default:o((()=>[a(_,{class:"row-content"},{default:o((()=>[a(_,{class:"row",onClick:t=>v.triggerClick(i.HMDrag_sort,i),style:l({height:w.rowHeight+"px"})},{default:o((()=>[i.icon?(e(),s(T,{key:0,class:"icon",src:i.icon},null,8,["src"])):r("",!0),a(D,{class:"text"},{default:o((()=>[n(h(i.name),1)])),_:2},1024)])),_:2},1032,["onClick","style"])])),_:2},1024),i.disabled?(e(),s(_,{key:0,class:"drag-content"},{default:o((()=>[a(_,{class:"drag-icon",style:l({height:w.rowHeight+"px"})},{default:o((()=>[a(D,{class:"iconfont icon-drag disabled"})])),_:1},8,["style"])])),_:1})):(e(),s(_,{key:1,class:"drag-content","data-id":i.HMDrag_id,onTouchstart:t.drag.touchstart,onTouchmove:t.drag.touchmove,onTouchend:t.drag.touchend},{default:o((()=>[a(_,{class:"drag-icon",style:l({height:w.rowHeight+"px"})},{default:o((()=>[a(D,{class:"iconfont icon-drag"})])),_:1},8,["style"])])),_:2},1032,["data-id","onTouchstart","onTouchmove","onTouchend"]))])),_:2},1024)])),_:2},1032,["style","data-sort","data-id","id"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["id","style","scroll-top","onScroll","scroll-with-animation"]),a(_,{id:"dataView",style:{display:"none !important"},"data-guid":H.guid,prop:H.wxsDataStr,"change:prop":t.drag.receiveData},{default:o((()=>[n(" 触发wxs跳板,请勿删除 ")])),_:1},8,["data-guid","prop","change:prop"]),a(_,{style:{display:"none !important"},prop:H.scrollCommand,"change:prop":t.renderjs.runCommand},{default:o((()=>[n(" 触发renderjs跳板,请勿删除 ")])),_:1},8,["prop","change:prop"])])),_:1},8,["style"])}],["__scopeId","data-v-b3414680"]]);const Y=W({data:()=>({tmplist:[{name:"花呗",icon:"/static/img/1.png"},{name:"余额宝",icon:"/static/img/2.png",disabled:!0},{name:"账户余额",icon:"/static/img/3.png"},{name:"交通银行信用卡(0001)",icon:"/static/img/4.png"},{name:"中国建设银行信用卡(4401)",icon:"/static/img/5.png"},{name:"网商储蓄卡(7223)",icon:"/static/img/6.png"},{name:"账户余额",icon:"/static/img/3.png"},{name:"交通银行信用卡(0001)",icon:"/static/img/4.png"},{name:"中国建设银行信用卡(4401)",icon:"/static/img/5.png"},{name:"网商储蓄卡(7223)",icon:"/static/img/6.png"}],list:[]}),onLoad(){let t=[];t.length=100,console.log(t);for(let i=0;i<t.length;i++){let e=i%10;t[i]=JSON.parse(JSON.stringify(this.tmplist[e])),t[i].id=i}this.list=t},methods:{push(){let t=this.$refs.dragSorts.push({name:"push行",icon:"/static/img/2.png"});console.log("push修改后的list: ",t)},unshift(){let t=this.$refs.dragSorts.unshift({name:"unshift行",icon:"/static/img/2.png"});console.log("unshift修改后的list: ",t)},splice(){let t=this.$refs.dragSorts.splice(1,1,{name:"splice行",icon:"/static/img/2.png"});console.log("splice修改后的list: ",t)},onclick(t){console.log("=== onclick start ==="),console.log("被点击行: ",JSON.stringify(t)),console.log("=== onclick end ===")},change(t){console.log("=== change start ==="),console.log("被拖拽行: ",JSON.stringify(t.moveRow)),console.log("原始下标: ",t.index),console.log("被拖拽到: ",t.moveTo),console.log("=== change end ===")},confirm(t){console.log("=== confirm start ==="),console.log("被拖拽行: ",JSON.stringify(t.moveRow)),console.log("原始下标: ",t.index),console.log("被拖拽到: ",t.moveTo),console.log("排序后的list: ",t.list),console.log("=== confirm end ===")}}},[["render",function(t,i,l,r,h,c){const g=(d=w("HM-dragSorts"),u=q,"string"==typeof d?u:d);var d,u;const m=p;return e(),s(m,{class:"content"},{default:o((()=>[a(g,{ref:"dragSorts",list:h.list,longTouch:!0,feedbackGenerator:!0,rowHeight:44,onOnclick:c.onclick,onChange:c.change,onConfirm:c.confirm},null,8,["list","onOnclick","onChange","onConfirm"]),a(m,{class:"test_btn"},{default:o((()=>[a(m,{onClick:c.push},{default:o((()=>[n("push")])),_:1},8,["onClick"]),a(m,{onClick:c.push},{default:o((()=>[n("push")])),_:1},8,["onClick"]),a(m,{onClick:c.unshift},{default:o((()=>[n("unshift")])),_:1},8,["onClick"]),a(m,{onClick:c.unshift},{default:o((()=>[n("unshift")])),_:1},8,["onClick"]),a(m,{onClick:c.splice},{default:o((()=>[n("splice")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-dfd659ee"]]);export{Y as default};
========
import{g as t,v as i,o as e,c as s,w as o,a,n as l,b as r,d as n,t as h,e as c,F as g,r as d,i as u,f as m,h as p,S as f,j as w}from"./index-DP8MDyZe.js";var S={},H={},v=!1,T=!1;function D(t){void 0===S[t]&&(S[t]=0)}var _=null,x=null,L=null,y=0,M=!1;function C(t,i){R.longTouch&&(v=!0,O(i,0))}var k="";function O(t,i){var e=t.getState();_.removeClass("hide"),_.hasClass("show")||_.addClass("show"),x.setStyle({transform:"translate3d(0,"+i+"px,10px)","-webkit-transform":"translate3d(0,"+i+"px,10px)"}),L.hasClass("hide")||L.addClass("hide"),L.removeClass("ani");var s=e.shadowRowTop+i+R.rowHeight/2,o=S[R.guid],a={guid:R.guid,command:s<.2*R.ListHeight?"up":s>R.ListHeight-.2*R.ListHeight?"down":"stop",scrollTop:o};k!=a.command&&(k=a.command,R.autoScroll&&t.callMethod("pageScroll",a));var l=i+S[R.guid]-e.initscrollTop,r=function(t,i){var e=t+parseInt(i/R.rowHeight),s=i%R.rowHeight;s>0?(e+=s/R.rowHeight>=.6?1:0)<b&&(e=s/R.rowHeight<=.4?e:b):(e+=s/R.rowHeight<=-.6?-1:0)>b&&(e=s/R.rowHeight>=-.4?e:b);return e}(y,l);if((r<=2||r>=R.listLength-2)&&(a.command="stop"),(!R.autoScroll||R.isAppH5||"stop"==a.command)&&(b=null==b?y:b,!(r<0||r>=R.listLength)&&r!=b)){b=r,e.offset=r,t.callMethod("change",{index:y,moveTo:e.offset});for(var n=0;n<H[R.guid].length;n++){var h=H[R.guid][n].lastSort,c=H[R.guid][n].newSort;if(c=h>=r&&h<=y||h<=r&&h>=y?h==y?r:h<y?h+1:h-1:h,H[R.guid][n].newSort!=c){H[R.guid][n].newSort=c;var g=100*(H[R.guid][n].newSort-H[R.guid][n].sort);H[R.guid][n].rowView.hasClass("ani")||H[R.guid][n].rowView.addClass("ani"),H[R.guid][n].rowView.setStyle({transform:"translate3d(0,"+g+"%,0)","-webkit-transform":"translate3d(0,"+g+"%,0)"})}}I(t)}}var b=null;var N,V,A="undefined"!=typeof plus&&"iOS"==plus.os.name;function I(t){R.feedbackGenerator&&(A?setTimeout((function(){V.selectionChanged()}),0):"undefined"!=typeof plus?plus.device.vibrate(12):t.callMethod("vibrate"))}A&&(N=plus.ios.importClass("UISelectionFeedbackGenerator"),(V=new N).init());var J={},R={};const j={receiveData:function(t,i,e){for(var s=JSON.parse(t),o={},a=!1,l=[],r=0;r<s.length;r++){var n=s[r];if("sortArray"===n[0])l=n[1];else"guid"==n[0]&&(a=!0),o[n[0]]=n[1]}if(a){var h=!1;void 0!==J[o.guid]&&void 0!==J[o.guid].lastInitTime&&J[o.guid].lastInitTime==o.lastInitTime||(h=!0),J[o.guid]=o,h&&function(t,i,e){H[t]=[];for(var s=i.selectAllComponents(".hm-row"),o=0;o<s.length;o++){var a={id:s[o].getDataset().id,sort:o,lastSort:parseInt(s[o].getDataset().sort),newSort:o,rowView:s[o]};e.length>0&&(a.lastSort=e[o],a.newSort=a.lastSort),H[t].push(a);var l=100*(a.lastSort-a.sort);a.rowView.setStyle({transform:"translate3d(0,"+l+"%,0)","-webkit-transform":"translate3d(0,"+l+"%,0)"})}}(o.guid,e,l)}},scroll:function(t,i){var e=i.selectComponent("#dataView").getDataset();D(e.guid),S[e.guid]=t.detail.scrollTop},longpress:C,touchstart:function(t,i){if(!M){M=!0,"undefined"==typeof setTimeout&&void 0!==i.setTimeout&&(setTimeout=i.setTimeout,clearTimeout=i.clearTimeout),v=!1;var e=t.instance.getDataset(),s=i.getState();1==t.touches.length&&(s.point=t.touches[0],s.islongTap=!0,s.rowData=e,function(t,i){var e=i.selectComponent("#dataView").getDataset();D((R=J[e.guid]).guid),t.initscrollTop=S[R.guid]}(s,i));var o=t.instance.getComputedStyle(["height"]);R.rowHeight=parseFloat(o.height);var a=(y=function(t,i){for(var e=0;e<H[R.guid].length;e++)if(H[R.guid][e].id==t)return L=H[R.guid][e].rowView,H[R.guid][e].lastSort}(e.id))*R.rowHeight;a-=S[R.guid],i.callMethod("loadShadowRow",{rowSort:y}),s.shadowRowTop=a,(_=i.selectComponent("#shadowRowBox")).setStyle({top:a+"px"}),x=i.selectComponent("#shadowRow"),R.longTouch&&(T&&clearTimeout(T),T=setTimeout((function(){C(t,i)}),R.longTouchTime))}},touchmove:function(t,i){var e=i.getState();t.instance.getDataset();var s=t.touches[0],o=e.point,a=s.pageY-o.pageY;if(!R.longTouch||(Math.abs(a)>10&&clearTimeout(T),v))return O(i,a),t.preventDefault&&t.preventDefault(),!1},touchend:function(t,i){if(R.longTouch&&(clearTimeout(T),!v))return b=null,void(M=!1);"stop"!=k&&(k="stop",R.autoScroll&&i.callMethod("pageScroll",{guid:R.guid,command:"stop"}));var e=i.getState();if(e.rowData.id,L.removeClass("hide"),e.offset,_.removeClass("show"),_.addClass("hide"),_.setStyle({}),void 0===e.offset||y==e.offset||null==e.offset)return M=!1,I(i),!1;for(var s=[],o=0;o<H[R.guid].length;o++)H[R.guid][o].lastSort=H[R.guid][o].newSort,s.push(H[R.guid][o].newSort),H[R.guid][o].rowView.removeClass("ani");return i.callMethod("sort",{index:y,offset:e.offset,sortArray:s}),e.offset=null,b=null,M=!1,I(i),!1}},F=t=>{t.$wxs||(t.$wxs=[]),t.$wxs.push("drag"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.drag=j}})},$={data:()=>({e:null,ScrollView:null}),methods:{runCommand(t){null!=t&&(this.e=t,this.getScrollView(document.getElementById("scrollView_"+this.e.guid)),window.cancelAnimationFrame(this.AnimationFrameID),this.AnimationFrameID=window.requestAnimationFrame(this.Animation),"stop"!=t.command||window.cancelAnimationFrame(this.AnimationFrameID))},Animation(){if("stop"==this.e.command)return void window.cancelAnimationFrame(this.AnimationFrameID);let t=this.e.rowLength*this.e.rowHeight-this.e.ListHeight;"up"==this.e.command?this.ScrollView.scrollTop-=3:"down"==this.e.command&&(this.ScrollView.scrollTop+=3),this.ScrollView.scrollTop<0&&(this.ScrollView.scrollTop=0,window.cancelAnimationFrame(this.AnimationFrameID)),this.ScrollView.scrollTop>t&&(this.ScrollView.scrollTop=t,window.cancelAnimationFrame(this.AnimationFrameID)),this.AnimationFrameID=window.requestAnimationFrame(this.Animation)},getScrollView(t){if(null!=this.ScrollView)return this.ScrollView;let i=t.getAttribute("style");if("uni-scroll-view"==t.className&&null!=i&&i.indexOf("overflow")>-1&&i.indexOf("auto")>-1)return this.ScrollView=t,t;this.getScrollView(t.firstChild)}}},G=t=>{t.$renderjs||(t.$renderjs=[]),t.$renderjs.push("renderjs"),t.mixins||(t.mixins=[]),t.mixins.push({beforeCreate(){this.renderjs=this},mounted(){this.$ownerInstance=this.$gcd(this,!0)}}),t.mixins.push($)},W=(t,i)=>{const e=t.__vccOpts||t;for(const[s,o]of i)e[s]=o;return e},B={name:"HM-dragSort",data(){return{guid:"",isAppH5:!0,shadowRow:{},dragList:[],ListHeight:this.listHeight,scrollViewTop:0,scrollCommand:null,isHoldTouch:!1,isScrolling:!1,scrollAnimation:!1,scrollTimer:null,wxsDataObj:[],wxsDataStr:"[]"}},emits:["change","confirm"],props:{feedbackGenerator:{value:Boolean,default:!0},longTouch:{value:Boolean,default:!1},autoScroll:{value:Boolean,default:!0},longTouchTime:{value:Number,default:300},list:{value:Array,default:[]},rowHeight:{value:Number,default:44},listHeight:{value:Number,default:0},listBackgroundColor:{value:String,default:"#fff"}},watch:{longTouch(t){t||console.error("vue3目前仅支持长按拖拽!"),this.pushWxsData("longTouch",t)},longTouchTime(t){this.pushWxsData("longTouchTime",t)},feedbackGenerator(t){this.pushWxsData("feedbackGenerator",t)},autoScroll(t){this.pushWxsData("autoScroll",t)},list:{handler(t){this.initList(t)},immediate:!0,deep:!0},listHeight:{handler(t){this.ListHeight=t,this.pushWxsData("ListHeight",this.ListHeight)},immediate:!0}},mounted(){this.guid=this.getGuid();const i=t();0==this.listHeight&&(this.ListHeight=i.windowHeight,i.windowHeight==i.screenHeight&&(this.ListHeight=i.windowHeight-45-i.statusBarHeight)),this.pushWxsData("isAppH5",this.isAppH5),this.pushWxsData("ListHeight",this.ListHeight),this.pushWxsData("longTouch",this.longTouch)},methods:{getGuid(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return t()+t()+"_"+t()+"_"+t()+"_"+t()+"_"+t()+t()+t()},initList(){let t=JSON.parse(JSON.stringify(this.list));for(let i=0,e=t.length;i<e;i++)t[i].hasOwnProperty("HMDrag_id")||(t[i].HMDrag_id="HMDragId_"+this.getGuid()),t[i].HMDrag_sort=i;this.dragList.length>0?setTimeout((()=>{this.dragList.splice(0,this.dragList.length,...t)}),50):this.dragList=JSON.parse(JSON.stringify(t)),this.pushWxsData("lastInitTime",(new Date).valueOf())},loadShadowRow(t){this.shadowRow=this.getMoveRow(t.rowSort)},vibrate(){i()},pageScroll(t){if("up"==t.command||"down"==t.command){if(this.isHoldTouch||(this.isHoldTouch=!0,this.scrollViewTop=t.scrollTop),this.isScrolling)return;if(this.isScrolling=!0,this.isAppH5)return t.ListHeight=this.ListHeight,t.rowHeight=this.rowHeight,t.rowLength=this.dragList.length,void(this.scrollCommand=t);null!=this.scrollTimer&&clearInterval(this.scrollTimer);let i=this.rowHeight*this.dragList.length+1-this.ListHeight,e=!0;this.scrollTimer=setInterval((()=>{e&&(this.runScroll(t.command,i),e=!1,this.$nextTick((function(){e=!0})))}),16.6)}"stop"==t.command&&(this.scrollCommand=t,this.isScrolling&&this.stopScroll())},runScroll(t,i){"up"==t&&(this.scrollViewTop-=5),"down"==t&&(this.scrollViewTop+=5),this.scrollViewTop<0&&(this.scrollViewTop=0,clearInterval(this.scrollTimer)),this.scrollViewTop>i&&(this.scrollViewTop=i,clearInterval(this.scrollTimer))},stopScroll(){null!=this.scrollTimer&&clearInterval(this.scrollTimer),this.isScrolling=!1,this.scrollingtop=0},getMoveRow(t){for(let i=0,e=this.dragList.length;i<e;i++)if(this.dragList[i].HMDrag_sort==t)return JSON.parse(JSON.stringify(this.dragList[i]))},triggerClick(t,i){let e=JSON.parse(JSON.stringify(i));delete e.HMDrag_id,delete e.HMDrag_sort,this.$emit("onclick",{index:t,row:JSON.parse(JSON.stringify(e))})},change(t){t.moveRow=this.getMoveRow(t.index),delete t.moveRow.HMDrag_id,delete t.moveRow.HMDrag_sort,this.$emit("change",t)},sort(t){this.stopScroll(),this.isHoldTouch=!1;let i=this.getMoveRow(t.index);delete i.HMDrag_id,delete i.HMDrag_sort;let e=JSON.parse(JSON.stringify(this.dragList)),s=[];for(let o=0,a=e.length;o<a;o++){delete e[o].HMDrag_id,delete e[o].HMDrag_sort;let i=t.sortArray[o];this.dragList[o].HMDrag_sort=i,s[i]=e[o]}this.$emit("confirm",{list:s,index:t.index,moveTo:t.offset,moveRow:i})},getNowList(){let t=JSON.parse(JSON.stringify(this.dragList)),i=[];for(let e=0,s=t.length;e<s;e++){let s=t[e].HMDrag_sort;i[s]=t[e],delete i[s].HMDrag_id,delete i[s].HMDrag_sort}return i},splice(){let t=arguments[0],i=arguments[1],e=arguments.length,s=[];for(let r=2;r<e;r++){let i=arguments[r];i.HMDrag_id="HMDragId_"+this.getGuid(),i.HMDrag_sort=t+r-2,s.push(i)}let o=t,a=i>0?t+i-1:t,l=s.length-i;for(let r=this.dragList.length-1;r>=0;r--){let t=this.dragList[r].HMDrag_sort;if(!(t<o))if(i>0&&t>=o&&t<=a)this.dragList.splice(r,1);else if(0!=l&&t>=a){let i=t+l;this.dragList[r].HMDrag_sort=i}}return this.dragList.push(...s),this.pushNewSort(),JSON.parse(JSON.stringify(this.dragList)),this.getNowList()},push(){let t=arguments.length,i=[],e=this.dragList.length;for(let s=0;s<t;s++){let t=arguments[s];t.HMDrag_id="HMDragId_"+this.getGuid(),t.HMDrag_sort=e+s,i.push(t)}return this.dragList.push(...i),this.pushNewSort(),this.getNowList()},unshift(){let t=arguments.length,i=[];for(let e=0;e<t;e++){let t=arguments[e];t.HMDrag_id="HMDragId_"+this.getGuid(),t.HMDrag_sort=e,i.push(t)}for(let e=this.dragList.length-1;e>=0;e--){let i=this.dragList[e].HMDrag_sort+t;this.dragList[e].HMDrag_sort=i}return this.dragList.push(...i),this.pushNewSort(),this.getNowList()},pushNewSort(){let t=[];for(let i=0,e=this.dragList.length;i<e;i++)t.push(this.dragList[i].HMDrag_sort);this.pushWxsData("sortArray",t),this.pushWxsData("lastInitTime",(new Date).valueOf())},pushWxsData(t=null,i=null){this.wxsDataObj.splice(0,8,["guid",this.guid],["listLength",this.dragList.length],["ListHeight",this.ListHeight],["isAppH5",this.isAppH5],["longTouch",this.longTouch],["longTouchTime",this.longTouchTime],["feedbackGenerator",this.feedbackGenerator],["autoScroll",this.autoScroll]);let e=-1;for(let s=0;s<this.wxsDataObj.length;s++)if(this.wxsDataObj[s][0]==t){e=s;break}e>-1?this.wxsDataObj[e][1]=i:(this.wxsDataObj.push([t,i]),"sortArray"==t&&this.wxsDataObj.length),""!=this.guid&&(this.wxsDataStr=JSON.stringify(this.wxsDataObj))},compareVersion(t,i){t=t.split("."),i=i.split(".");const e=Math.max(t.length,i.length);for(;t.length<e;)t.push("0");for(;i.length<e;)i.push("0");for(let s=0;s<e;s++){const e=parseInt(t[s]),o=parseInt(i[s]);if(e>o)return 1;if(e<o)return-1}return 0}}};F(B),G(B);const q=W(B,[["render",function(t,i,w,S,H,v){const T=u,D=m,_=p,x=f;return e(),s(_,{class:"HM-drag-sort",style:l({height:H.ListHeight+"px","background-color":w.listBackgroundColor})},{default:o((()=>[a(_,{class:"rowBox-shadow",id:"shadowRowBox"},{default:o((()=>[a(_,{class:"hm-row-shadow move",id:"shadowRow"},{default:o((()=>[a(_,{class:"modules"},{default:o((()=>[a(_,{class:"row-content"},{default:o((()=>[a(_,{class:"row",style:l({height:w.rowHeight+"px"})},{default:o((()=>[H.shadowRow.icon?(e(),s(T,{key:0,class:"icon",src:H.shadowRow.icon},null,8,["src"])):r("",!0),a(D,{class:"text"},{default:o((()=>[n(h(H.shadowRow.name),1)])),_:1})])),_:1},8,["style"])])),_:1}),a(_,{class:"drag-content"},{default:o((()=>[a(_,{class:"drag-icon",style:l({height:w.rowHeight+"px"})},{default:o((()=>[a(D,{class:"iconfont icon-drag"})])),_:1},8,["style"])])),_:1})])),_:1})])),_:1})])),_:1}),a(x,{class:"color scroll-view",id:"scrollView_"+H.guid,"scroll-y":!0,style:l({height:H.ListHeight+"px"}),"scroll-top":H.scrollViewTop,onScroll:t.drag.scroll,"scroll-with-animation":H.scrollAnimation},{default:o((()=>[a(_,{class:"list"},{default:o((()=>[(e(!0),c(g,null,d(H.dragList,((i,c)=>(e(),s(_,{key:i.HMDrag_id,class:"rowBox ani"},{default:o((()=>[a(_,{class:"hm-row",style:l({transform:"translate3d(0,"+100*(i.HMDrag_sort-c)+"%,-1px)"}),"data-sort":i.HMDrag_sort,"data-id":i.HMDrag_id,id:i.HMDrag_id},{default:o((()=>[a(_,{class:"modules"},{default:o((()=>[a(_,{class:"row-content"},{default:o((()=>[a(_,{class:"row",onClick:t=>v.triggerClick(i.HMDrag_sort,i),style:l({height:w.rowHeight+"px"})},{default:o((()=>[i.icon?(e(),s(T,{key:0,class:"icon",src:i.icon},null,8,["src"])):r("",!0),a(D,{class:"text"},{default:o((()=>[n(h(i.name),1)])),_:2},1024)])),_:2},1032,["onClick","style"])])),_:2},1024),i.disabled?(e(),s(_,{key:0,class:"drag-content"},{default:o((()=>[a(_,{class:"drag-icon",style:l({height:w.rowHeight+"px"})},{default:o((()=>[a(D,{class:"iconfont icon-drag disabled"})])),_:1},8,["style"])])),_:1})):(e(),s(_,{key:1,class:"drag-content","data-id":i.HMDrag_id,onTouchstart:t.drag.touchstart,onTouchmove:t.drag.touchmove,onTouchend:t.drag.touchend},{default:o((()=>[a(_,{class:"drag-icon",style:l({height:w.rowHeight+"px"})},{default:o((()=>[a(D,{class:"iconfont icon-drag"})])),_:1},8,["style"])])),_:2},1032,["data-id","onTouchstart","onTouchmove","onTouchend"]))])),_:2},1024)])),_:2},1032,["style","data-sort","data-id","id"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["id","style","scroll-top","onScroll","scroll-with-animation"]),a(_,{id:"dataView",style:{display:"none !important"},"data-guid":H.guid,prop:H.wxsDataStr,"change:prop":t.drag.receiveData},{default:o((()=>[n(" 触发wxs跳板,请勿删除 ")])),_:1},8,["data-guid","prop","change:prop"]),a(_,{style:{display:"none !important"},prop:H.scrollCommand,"change:prop":t.renderjs.runCommand},{default:o((()=>[n(" 触发renderjs跳板,请勿删除 ")])),_:1},8,["prop","change:prop"])])),_:1},8,["style"])}],["__scopeId","data-v-20f08c20"]]);const Y=W({data:()=>({tmplist:[{name:"花呗123456",icon:"/static/img/1.png"},{name:"余额宝",icon:"/static/img/2.png",disabled:!0},{name:"账户余额",icon:"/static/img/3.png"},{name:"交通银行信用卡(0001)",icon:"/static/img/4.png"},{name:"中国建设银行信用卡(4401)",icon:"/static/img/5.png"},{name:"网商储蓄卡(7223)",icon:"/static/img/6.png"},{name:"账户余额",icon:"/static/img/3.png"},{name:"交通银行信用卡(0001)",icon:"/static/img/4.png"},{name:"中国建设银行信用卡(4401)",icon:"/static/img/5.png"},{name:"网商储蓄卡(7223)",icon:"/static/img/6.png"}],list:[]}),onLoad(){let t=[];t.length=100;for(let i=0;i<t.length;i++){let e=i%10;t[i]=JSON.parse(JSON.stringify(this.tmplist[e])),t[i].id=i}this.list=t},methods:{push(){let t=this.$refs.dragSorts.push({name:"push行",icon:"/static/img/2.png"});console.log("push修改后的list: ",t)},unshift(){let t=this.$refs.dragSorts.unshift({name:"unshift行",icon:"/static/img/2.png"});console.log("unshift修改后的list: ",t)},splice(){let t=this.$refs.dragSorts.splice(1,1,{name:"splice行",icon:"/static/img/2.png"});console.log("splice修改后的list: ",t)},onclick(t){console.log("=== onclick start ==="),console.log("被点击行: ",JSON.stringify(t)),console.log("=== onclick end ===")},change(t){console.log("=== change start ==="),console.log("被拖拽行: ",JSON.stringify(t.moveRow)),console.log("原始下标: ",t.index),console.log("被拖拽到: ",t.moveTo),console.log("=== change end ===")},confirm(t){console.log("=== confirm start ==="),console.log("被拖拽行: ",JSON.stringify(t.moveRow)),console.log("原始下标: ",t.index),console.log("被拖拽到: ",t.moveTo),console.log("排序后的list: ",t.list),console.log("=== confirm end ===")}}},[["render",function(t,i,l,r,h,c){const g=(d=w("HM-dragSorts"),u=q,"string"==typeof d?u:d);var d,u;const m=p;return e(),s(m,{class:"content"},{default:o((()=>[a(g,{ref:"dragSorts",list:h.list,longTouch:!0,feedbackGenerator:!0,rowHeight:44,onOnclick:c.onclick,onChange:c.change,onConfirm:c.confirm},null,8,["list","onOnclick","onChange","onConfirm"]),a(m,{class:"test_btn"},{default:o((()=>[a(m,{onClick:c.push},{default:o((()=>[n("push")])),_:1},8,["onClick"]),a(m,{onClick:c.push},{default:o((()=>[n("push")])),_:1},8,["onClick"]),a(m,{onClick:c.unshift},{default:o((()=>[n("unshift")])),_:1},8,["onClick"]),a(m,{onClick:c.unshift},{default:o((()=>[n("unshift")])),_:1},8,["onClick"]),a(m,{onClick:c.splice},{default:o((()=>[n("splice")])),_:1},8,["onClick"])])),_:1})])),_:1})}],["__scopeId","data-v-8eb24db8"]]);export{Y as default};
>>>>>>>> f69f88ceccb412be4cdb4d01a4a7f8f1bada62b6:build/h5/assets/pages-index-index.C_dH9rnf.js
